<!--With the new graphs, charts and tables, the site/index.html file is updated to include the new content. -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Reports Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .report-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        .category-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            margin-bottom: 2rem;
        }
        .metric-card {
            background: white;
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
        }
        .metric-label {
            font-size: 0.875rem;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .status-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 1rem;
        }
        .chart-container {
            height: 300px;
        }
        .table-responsive {
            max-height: 400px;
            overflow-y: auto;
        }
        .test-summary {
            background: #f8f9fa;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        .test-summary h6 {
            margin-bottom: 1rem;
            color: #495057;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container py-5">
        <div class="category-header text-center">
            <h1 class="display-4 fw-bold"><i class="bi bi-speedometer2"></i> Test Reports Dashboard</h1>
            <p class="lead">BBC Senior Tester Take-home Test - Automated Test Results</p>
            <div class="row mt-4">
                <div class="col-md-3">
                    <div class="d-flex align-items-center justify-content-center">
                        <i class="bi bi-circle-fill text-success me-2"></i>
                        <span class="fw-bold">Playwright Status: <span id="playwright-status">UNKNOWN</span></span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="d-flex align-items-center justify-content-center">
                        <i class="bi bi-circle-fill text-warning me-2"></i>
                        <span class="fw-bold">k6 Status: <span id="k6-status">UNKNOWN</span></span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="d-flex align-items-center justify-content-center">
                        <i class="bi bi-circle-fill text-info me-2"></i>
                        <span class="fw-bold">Last Run: <span id="last-run">--</span></span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="d-flex align-items-center justify-content-center">
                        <i class="bi bi-circle-fill text-primary me-2"></i>
                        <span class="fw-bold">Commit: <span id="commit-hash">--</span></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Playwright Test Reports -->
        <div class="row mb-5">
            <div class="col-12">
                <h2 class="mb-4"><i class="bi bi-bug"></i> Playwright Test Reports</h2>
            </div>
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="bi bi-house report-icon text-primary"></i>
                        <h5 class="card-title">Pet Tests</h5>
                        <p class="card-text">Playwright tests for Pet API endpoints</p>
                        <a href="./playwright-report/ortoni-report.html" class="btn btn-primary" target="_blank">
                            <i class="bi bi-eye"></i> View Report
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="bi bi-shop report-icon text-success"></i>
                        <h5 class="card-title">Store Tests</h5>
                        <p class="card-text">Playwright tests for Store API endpoints</p>
                        <a href="./playwright-report/ortoni-report.html" class="btn btn-success" target="_blank">
                            <i class="bi bi-eye"></i> View Report
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="bi bi-person report-icon text-info"></i>
                        <h5 class="card-title">User Tests</h5>
                        <p class="card-text">Playwright tests for User API endpoints</p>
                        <a href="./playwright-report/ortoni-report.html" class="btn btn-info" target="_blank">
                            <i class="bi bi-eye"></i> View Report
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ortoni Report -->
        <div class="row mb-5">
            <div class="col-12">
                <h2 class="mb-4"><i class="bi bi-clipboard-data"></i> Comprehensive Test Report</h2>
            </div>
            <div class="col-12">
                <div class="card">
                    <div class="card-body text-center py-5">
                        <i class="bi bi-graph-up report-icon text-warning"></i>
                        <h5 class="card-title">Ortoni HTML Report</h5>
                        <p class="card-text">Combined test report with all Playwright and k6 test results</p>
                        <a href="./ortoni-report.html" class="btn btn-warning btn-lg" target="_blank">
                            <i class="bi bi-eye"></i> View Ortoni Report
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- k6 Performance Test Reports with Stats and Graphs -->
        <div class="row mb-5">
            <div class="col-12">
                <h2 class="mb-4"><i class="bi bi-lightning"></i> k6 Performance Test Reports</h2>
            </div>
            
            <!-- Load Test -->
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header bg-danger text-white">
                        <h5 class="mb-0"><i class="bi bi-arrow-up-right me-2"></i>Load Test</h5>
                    </div>
                    <div class="card-body">
                        <div class="test-summary">
                            <h6><i class="bi bi-bar-chart me-2"></i>Test Summary</h6>
                            <div class="row text-center">
                                <div class="col-md-3">
                                    <div class="metric-value text-danger" id="load-total-requests">46,046</div>
                                    <div class="metric-label">Total Requests</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="metric-value text-success" id="load-success-rate">0%</div>
                                    <div class="metric-label">Success Rate</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="metric-value text-warning" id="load-avg-response">88.85ms</div>
                                    <div class="metric-label">Avg Response Time</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="metric-value text-info" id="load-p95-response">94.24ms</div>
                                    <div class="metric-label">P95 Response Time</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-8">
                                <div class="chart-container">
                                    <canvas id="load-chart"></canvas>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <h6><i class="bi bi-list-ul me-2"></i>Key Metrics</h6>
                                <table class="table table-sm">
                                    <tbody id="load-metrics-table">
                                        <tr><td>Requests/sec</td><td id="load-rps">168.47</td></tr>
                                        <tr><td>Failed Requests</td><td id="load-failed">46,046</td></tr>
                                        <tr><td>Min Response</td><td id="load-min">80.02ms</td></tr>
                                        <tr><td>Max Response</td><td id="load-max">145.45ms</td></tr>
                                        <tr><td>P99 Response</td><td id="load-p99">0ms</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <a href="./k6/load/index.html" class="btn btn-danger btn-sm" target="_blank">
                                <i class="bi bi-file-earmark-text"></i> Detailed Report
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Test -->
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="bi bi-speedometer me-2"></i>Performance Test</h5>
                    </div>
                    <div class="card-body">
                        <div class="test-summary">
                            <h6><i class="bi bi-bar-chart me-2"></i>Test Summary</h6>
                            <div class="row text-center">
                                <div class="col-md-3">
                                    <div class="metric-value text-primary" id="perf-total-requests">80</div>
                                    <div class="metric-label">Total Requests</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="metric-value text-success" id="perf-success-rate">0%</div>
                                    <div class="metric-label">Success Rate</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="metric-value text-warning" id="perf-avg-response">180ms</div>
                                    <div class="metric-label">Avg Response Time</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="metric-value text-info" id="perf-p95-response">360ms</div>
                                    <div class="metric-label">P95 Response Time</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-8">
                                <div class="chart-container">
                                    <canvas id="perf-chart"></canvas>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <h6><i class="bi bi-list-ul me-2"></i>Key Metrics</h6>
                                <table class="table table-sm">
                                    <tbody id="perf-metrics-table">
                                        <tr><td>Requests/sec</td><td id="perf-rps">0</td></tr>
                                        <tr><td>Failed Requests</td><td id="perf-failed">0</td></tr>
                                        <tr><td>Min Response</td><td id="perf-min">80ms</td></tr>
                                        <tr><td>Max Response</td><td id="perf-max">400ms</td></tr>
                                        <tr><td>P99 Response</td><td id="perf-p99">390ms</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <a href="./k6/performance/index.html" class="btn btn-primary btn-sm" target="_blank">
                                <i class="bi bi-file-earmark-text"></i> Detailed Report
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stress Test -->
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="bi bi-battery-full me-2"></i>Stress Test</h5>
                    </div>
                    <div class="card-body">
                        <div class="test-summary">
                            <h6><i class="bi bi-bar-chart me-2"></i>Test Summary</h6>
                            <div class="row text-center">
                                <div class="col-md-3">
                                    <div class="metric-value text-warning" id="stress-total-requests">547,860</div>
                                    <div class="metric-label">Total Requests</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="metric-value text-success" id="stress-success-rate">0%</div>
                                    <div class="metric-label">Success Rate</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="metric-value text-danger" id="stress-avg-response">88.92ms</div>
                                    <div class="metric-label">Avg Response Time</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="metric-value text-info" id="stress-p95-response">95.17ms</div>
                                    <div class="metric-label">P95 Response Time</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-8">
                                <div class="chart-container">
                                    <canvas id="stress-chart"></canvas>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <h6><i class="bi bi-list-ul me-2"></i>Key Metrics</h6>
                                <table class="table table-sm">
                                    <tbody id="stress-metrics-table">
                                        <tr><td>Requests/sec</td><td id="stress-rps">1,217.02</td></tr>
                                        <tr><td>Failed Requests</td><td id="stress-failed">124,420</td></tr>
                                        <tr><td>Min Response</td><td id="stress-min">78.46ms</td></tr>
                                        <tr><td>Max Response</td><td id="stress-max">288.32ms</td></tr>
                                        <tr><td>P99 Response</td><td id="stress-p99">0ms</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <a href="./k6/stress/index.html" class="btn btn-warning btn-sm" target="_blank">
                                <i class="bi bi-file-earmark-text"></i> Detailed Report
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Security Test -->
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="bi bi-shield-check me-2"></i>Security Test</h5>
                    </div>
                    <div class="card-body">
                        <div class="test-summary">
                            <h6><i class="bi bi-bar-chart me-2"></i>Test Summary</h6>
                            <div class="row text-center">
                                <div class="col-md-3">
                                    <div class="metric-value text-success" id="security-total-requests">50</div>
                                    <div class="metric-label">Total Requests</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="metric-value text-success" id="security-success-rate">0%</div>
                                    <div class="metric-label">Success Rate</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="metric-value text-warning" id="security-avg-response">400ms</div>
                                    <div class="metric-label">Avg Response Time</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="metric-value text-info" id="security-p95-response">720ms</div>
                                    <div class="metric-label">P95 Response Time</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-8">
                                <div class="chart-container">
                                    <canvas id="security-chart"></canvas>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <h6><i class="bi bi-list-ul me-2"></i>Key Metrics</h6>
                                <table class="table table-sm">
                                    <tbody id="security-metrics-table">
                                        <tr><td>Requests/sec</td><td id="security-rps">0</td></tr>
                                        <tr><td>Failed Requests</td><td id="security-failed">0</td></tr>
                                        <tr><td>Min Response</td><td id="security-min">150ms</td></tr>
                                        <tr><td>Max Response</td><td id="security-max">800ms</td></tr>
                                        <tr><td>P99 Response</td><td id="security-p99">780ms</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <a href="./k6/security/index.html" class="btn btn-success btn-sm" target="_blank">
                                <i class="bi bi-file-earmark-text"></i> Detailed Report
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Data Table -->
        <div class="row mb-5">
            <div class="col-12">
                <h2 class="mb-4"><i class="bi bi-table"></i> Test Results Data Table</h2>
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Test Type</th>
                                        <th>Total Requests</th>
                                        <th>Success Rate</th>
                                        <th>Failed Requests</th>
                                        <th>Avg Response Time</th>
                                        <th>P95 Response Time</th>
                                        <th>P99 Response Time</th>
                                        <th>Min Response</th>
                                        <th>Max Response</th>
                                        <th>Requests/sec</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="test-results-table">
        <tr>
          <td><i class="bi bi-arrow-up-right text-danger me-2"></i>Load Test</td>
          <td>46,046</td>
          <td><span class="badge bg-danger">0%</span></td>
          <td>46,046</td>
          <td>88.85ms</td>
          <td>94.24ms</td>
          <td>0ms</td>
          <td>80.02ms</td>
          <td>145.45ms</td>
          <td>168.47</td>
          <td><span class="badge bg-warning">WARNING</span></td>
          <td>
            <a href="./k6/load/index.html" class="btn btn-outline-danger btn-sm" target="_blank">
              <i class="bi bi-file-earmark-text"></i> Report
            </a>
          </td>
        </tr>
      
        <tr>
          <td><i class="bi bi-speedometer text-primary me-2"></i>Performance Test</td>
          <td>80</td>
          <td><span class="badge bg-success">100%</span></td>
          <td>0</td>
          <td>180ms</td>
          <td>360ms</td>
          <td>390ms</td>
          <td>80ms</td>
          <td>400ms</td>
          <td>0</td>
          <td><span class="badge bg-success">PASS</span></td>
          <td>
            <a href="./k6/performance/index.html" class="btn btn-outline-primary btn-sm" target="_blank">
              <i class="bi bi-file-earmark-text"></i> Report
            </a>
          </td>
        </tr>
      
        <tr>
          <td><i class="bi bi-battery-full text-warning me-2"></i>Stress Test</td>
          <td>547,860</td>
          <td><span class="badge bg-warning">77.29%</span></td>
          <td>124,420</td>
          <td>88.92ms</td>
          <td>95.17ms</td>
          <td>0ms</td>
          <td>78.46ms</td>
          <td>288.32ms</td>
          <td>1,217.02</td>
          <td><span class="badge bg-warning">WARNING</span></td>
          <td>
            <a href="./k6/stress/index.html" class="btn btn-outline-warning btn-sm" target="_blank">
              <i class="bi bi-file-earmark-text"></i> Report
            </a>
          </td>
        </tr>
      
        <tr>
          <td><i class="bi bi-shield-check text-success me-2"></i>Security Test</td>
          <td>50</td>
          <td><span class="badge bg-success">100%</span></td>
          <td>0</td>
          <td>400ms</td>
          <td>720ms</td>
          <td>780ms</td>
          <td>150ms</td>
          <td>800ms</td>
          <td>0</td>
          <td><span class="badge bg-success">PASS</span></td>
          <td>
            <a href="./k6/security/index.html" class="btn btn-outline-success btn-sm" target="_blank">
              <i class="bi bi-file-earmark-text"></i> Report
            </a>
          </td>
        </tr>
      </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="row">
            <div class="col-12 text-center text-muted">
                <p><i class="bi bi-github"></i> BBC Senior Tester Take-home Test</p>
                <p class="small">Reports generated automatically by GitHub Actions</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Dashboard data and functionality - DYNAMICALLY LOADED FROM K6 SUMMARY FILES
    
    // Initialize dashboard data object
    let dashboardData = {
      "load": {
        "totalRequests": 0,
        "failedRequests": 0,
        "successRate": 0,
        "avgResponseTime": 0,
        "p95ResponseTime": 0,
        "p99ResponseTime": 0,
        "minResponseTime": 0,
        "maxResponseTime": 0,
        "requestsPerSecond": 0
      },
      "performance": {
        "totalRequests": 0,
        "failedRequests": 0,
        "successRate": 0,
        "avgResponseTime": 0,
        "p95ResponseTime": 0,
        "p99ResponseTime": 0,
        "minResponseTime": 0,
        "maxResponseTime": 0,
        "requestsPerSecond": 0
      },
      "stress": {
        "totalRequests": 0,
        "failedRequests": 0,
        "successRate": 0,
        "avgResponseTime": 0,
        "p95ResponseTime": 0,
        "p99ResponseTime": 0,
        "minResponseTime": 0,
        "maxResponseTime": 0,
        "requestsPerSecond": 0
      },
      "security": {
        "totalRequests": 0,
        "failedRequests": 0,
        "successRate": 0,
        "avgResponseTime": 0,
        "p95ResponseTime": 0,
        "p99ResponseTime": 0,
        "minResponseTime": 0,
        "maxResponseTime": 0,
        "requestsPerSecond": 0
      }
    };
    
    // Function to load k6 data from summary files
    async function loadK6Data(testType) {
      try {
        // Try to load from site/k6-results directory
        const response = await fetch(`site/k6-results/${testType}-summary.json`);
        if (response.ok) {
          const data = await response.json();
          return processK6Data(data);
        }
      } catch (error) {
        console.log(`Error loading ${testType} data:`, error);
      }
      
      // Try alternative location in site/k6-summary
      try {
        const response = await fetch(`site/k6-summary/${testType}-summary.json`);
        if (response.ok) {
          const data = await response.json();
          return processK6Data(data);
        }
      } catch (error) {
        console.log(`Error loading ${testType} data from alternative location:`, error);
      }
      
      // Try root k6-results directory
      try {
        const response = await fetch(`k6-results/${testType}-summary.json`);
        if (response.ok) {
          const data = await response.json();
          return processK6Data(data);
        }
      } catch (error) {
        console.log(`Error loading ${testType} data from root k6-results:`, error);
      }
      
      // Try root k6-summary directory
      try {
        const response = await fetch(`k6-summary/${testType}-summary.json`);
        if (response.ok) {
          const data = await response.json();
          return processK6Data(data);
        }
      } catch (error) {
        console.log(`Error loading ${testType} data from root k6-summary:`, error);
      }
      
      // Return empty data if no files found
      return {
        totalRequests: 0,
        failedRequests: 0,
        successRate: 0,
        avgResponseTime: 0,
        p95ResponseTime: 0,
        p99ResponseTime: 0,
        minResponseTime: 0,
        maxResponseTime: 0,
        requestsPerSecond: 0
      };
    }
    
    // Process k6 JSON data
    function processK6Data(data) {
      try {
        // Parse actual k6 JSON structure and extract metrics
        let totalRequests = 0;
        let failedRequests = 0;
        let avgResponseTime = 0;
        let p95ResponseTime = 0;
        let p99ResponseTime = 0;
        let minResponseTime = 0;
        let maxResponseTime = 0;
        let requestsPerSecond = 0;
        
        // Handle the actual k6 JSON format from summary files
        if (data.metrics) {
          // Extract total requests from http_reqs
          if (data.metrics.http_reqs) {
            totalRequests = data.metrics.http_reqs.count || 0;
          }
          
          // Extract failed requests from http_req_failed
          if (data.metrics.http_req_failed) {
            failedRequests = data.metrics.http_req_failed.count || 0;
          }
          
          // Extract response time metrics from http_req_duration
          if (data.metrics.http_req_duration) {
            const durationMetric = data.metrics.http_req_duration;
            avgResponseTime = Math.round(durationMetric.avg || 0);
            p95ResponseTime = Math.round(durationMetric['p(95)'] || 0);
            p99ResponseTime = Math.round(durationMetric['p(99)'] || 0);
            minResponseTime = Math.round(durationMetric.min || 0);
            maxResponseTime = Math.round(durationMetric.max || 0);
          }
        }
        
        // Calculate success rate
        const successRate = totalRequests > 0 ? Math.round(((totalRequests - failedRequests) / totalRequests) * 100) : 0;
        
        // Calculate requests per second (if available)
        if (data.metrics && data.metrics.http_reqs && data.metrics.http_reqs.rate) {
          requestsPerSecond = Math.round(data.metrics.http_reqs.rate || 0);
        }
        
        return {
          totalRequests: totalRequests,
          successRate: successRate,
          failedRequests: failedRequests,
          avgResponseTime: avgResponseTime,
          p95ResponseTime: p95ResponseTime,
          p99ResponseTime: p99ResponseTime,
          minResponseTime: minResponseTime,
          maxResponseTime: maxResponseTime,
          requestsPerSecond: requestsPerSecond
        };
      } catch (error) {
        console.error('Error processing k6 data:', error);
        return {
          totalRequests: 0,
          failedRequests: 0,
          successRate: 0,
          avgResponseTime: 0,
          p95ResponseTime: 0,
          p99ResponseTime: 0,
          minResponseTime: 0,
          maxResponseTime: 0,
          requestsPerSecond: 0
        };
      }
    }
    
    // Update dashboard with loaded data
    function updateDashboardWithData() {
      const testTypes = ['load', 'performance', 'stress', 'security'];
      
      testTypes.forEach(testType => {
        const data = dashboardData[testType];
        const prefix = testType === 'performance' ? 'perf' : testType;
        
        // Update metric displays
        document.getElementById(`${prefix}-total-requests`).textContent = data.totalRequests.toLocaleString();
        document.getElementById(`${prefix}-success-rate`).textContent = `${data.successRate}%`;
        document.getElementById(`${prefix}-avg-response`).textContent = `${data.avgResponseTime}ms`;
        document.getElementById(`${prefix}-p95-response`).textContent = `${data.p95ResponseTime}ms`;
        
        // Update detailed metrics table
        document.getElementById(`${prefix}-rps`).textContent = data.requestsPerSecond;
        document.getElementById(`${prefix}-failed`).textContent = data.failedRequests;
        document.getElementById(`${prefix}-min`).textContent = `${data.minResponseTime}ms`;
        document.getElementById(`${prefix}-max`).textContent = `${data.maxResponseTime}ms`;
        document.getElementById(`${prefix}-p99`).textContent = `${data.p99ResponseTime}ms`;
      });
      
      // Update data table
      updateDataTable();
    }
    
    // Update data table
    function updateDataTable() {
      const tbody = document.getElementById('test-results-table');
      if (!tbody) return;
      
      tbody.innerHTML = '';
      
      const testTypes = [
        { key: 'load', name: 'Load Test', icon: 'arrow-up-right', color: 'danger' },
        { key: 'performance', name: 'Performance Test', icon: 'speedometer', color: 'primary' },
        { key: 'stress', name: 'Stress Test', icon: 'battery-full', color: 'warning' },
        { key: 'security', name: 'Security Test', icon: 'shield-check', color: 'success' }
      ];

      testTypes.forEach(test => {
        const data = dashboardData[test.key];
        const row = document.createElement('tr');
        
        row.innerHTML = `
          <td><i class="bi bi-${test.icon} text-${test.color} me-2"></i>${test.name}</td>
          <td>${data.totalRequests.toLocaleString()}</td>
          <td><span class="badge bg-${data.successRate >= 90 ? 'success' : data.successRate >= 70 ? 'warning' : 'danger'}">${data.successRate}%</span></td>
          <td>${data.failedRequests}</td>
          <td>${data.avgResponseTime}ms</td>
          <td>${data.p95ResponseTime}ms</td>
          <td>${data.p99ResponseTime}ms</td>
          <td>${data.minResponseTime}ms</td>
          <td>${data.maxResponseTime}ms</td>
          <td>${data.requestsPerSecond}</td>
          <td><span class="badge bg-${data.successRate >= 90 ? 'success' : 'warning'}">${data.successRate >= 90 ? 'PASS' : 'WARNING'}</span></td>
          <td>
            <a href="./k6/${test.key}/index.html" class="btn btn-outline-${test.color} btn-sm" target="_blank">
              <i class="bi bi-file-earmark-text"></i> Report
            </a>
          </td>
        `;
        
        tbody.appendChild(row);
      });
    }
    
    // Initialize charts with loaded data
    function initializeCharts() {
      const chartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false }
        },
        scales: {
          y: { beginAtZero: true }
        }
      };

      const testTypes = ['load', 'performance', 'stress', 'security'];
      
      testTypes.forEach(testType => {
        const data = dashboardData[testType];
        const chartId = testType === 'performance' ? 'perf-chart' : `${testType}-chart`;
        const canvas = document.getElementById(chartId);
        
        if (canvas) {
          const ctx = canvas.getContext('2d');
          const chart = new Chart(ctx, {
            type: testType === 'stress' ? 'doughnut' : testType === 'security' ? 'radar' : 'bar',
            data: {
              labels: ['Total Requests', 'Success Rate', 'Avg Response', 'P95 Response'],
              datasets: [{
                data: [
                  data.totalRequests,
                  data.successRate,
                  data.avgResponseTime,
                  data.p95ResponseTime
                ],
                backgroundColor: testType === 'load' ? ['#dc3545', '#28a745', '#ffc107', '#17a2b8'] :
                               testType === 'performance' ? ['#007bff'] :
                               testType === 'stress' ? ['#ffc107', '#dc3545', '#6c757d'] :
                               ['#28a745']
              }]
            },
            options: testType === 'security' ? {
              responsive: true,
              maintainAspectRatio: false,
              scales: { r: { beginAtZero: true, max: 100 } }
            } : chartOptions
          });
          
          if (!window.charts) window.charts = {};
          window.charts[testType] = chart;
        }
      });
    }
    
    // Load all k6 data
    async function loadAllK6Data() {
      try {
        const testTypes = ['load', 'performance', 'stress', 'security'];
        
        for (const testType of testTypes) {
          dashboardData[testType] = await loadK6Data(testType);
        }
        
        // Update dashboard with loaded data
        updateDashboardWithData();
        
        // Initialize charts
        initializeCharts();
        
        console.log('Dashboard updated with k6 metrics from summary files');
        
      } catch (error) {
        console.error('Error loading k6 data:', error);
      }
    }
    
    // Load GitHub Actions data
    async function loadGitHubData() {
      try {
        // Try to load GitHub Actions data from site directory
        const response = await fetch('site/runtime-data.json');
        if (response.ok) {
          const githubData = await response.json();
          updateGitHubStatus(githubData);
        } else {
          // Try alternative location in root
          const altResponse = await fetch('runtime-data.json');
          if (altResponse.ok) {
            const githubData = await altResponse.json();
            updateGitHubStatus(githubData);
          }
        }
      } catch (error) {
        console.log('No GitHub data found:', error);
        // Set default status
        document.getElementById('playwright-status').textContent = 'UNKNOWN';
        document.getElementById('k6-status').textContent = 'UNKNOWN';
        document.getElementById('last-run').textContent = '--';
        document.getElementById('commit-hash').textContent = '--';
      }
    }
    
    // Update GitHub Actions status indicators
    function updateGitHubStatus(data) {
      const playwrightStatus = data.playwright_status || 'UNKNOWN';
      const k6Status = data.k6_status || 'UNKNOWN';
      const lastRun = data.last_run || '--';
      const commitHash = data.commit_hash || '--';
      
      document.getElementById('playwright-status').textContent = playwrightStatus;
      document.getElementById('k6-status').textContent = k6Status;
      document.getElementById('last-run').textContent = lastRun;
      document.getElementById('commit-hash').textContent = commitHash;
      
      // Update status indicator colors
      const playwrightBadge = document.querySelector('#playwright-status').parentElement;
      const k6Badge = document.querySelector('#k6-status').parentElement;
      
      if (playwrightStatus === 'PASSED') {
        playwrightBadge.innerHTML = playwrightBadge.innerHTML.replace('text-success', 'text-success');
      } else if (playwrightStatus === 'FAILED') {
        playwrightBadge.innerHTML = playwrightBadge.innerHTML.replace('text-success', 'text-danger');
      }
      
      if (k6Status === 'PASSED') {
        k6Badge.innerHTML = k6Badge.innerHTML.replace('text-warning', 'text-success');
      } else if (k6Status === 'FAILED') {
        k6Badge.innerHTML = k6Badge.innerHTML.replace('text-warning', 'text-danger');
      }
    }
    
    // Initialize dashboard
    document.addEventListener('DOMContentLoaded', function() {
      // Load k6 data from summary files
      loadAllK6Data();
      
      // Load GitHub Actions data
      loadGitHubData();
    });

    </script>
</body>
</html>